<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Интернет-магазин</title>
    <style type="text/css">
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap');

        * {
            margin: 0;
            padding: 0;
            font-family: "Roboto";
        }

        a {
            text-decoration: none;
        }

        header {
            background-color: #2c2c34;
        }

        .container {
            margin: 0px auto;
            max-width: 1280px;
            position: relative;
        }

        .box-menu {
            display: flex;
            justify-content: space-between;
            box-sizing: border-box;
            padding: 10px 0px;
        }

        .btnCoat {
            background-color: #3c4856;
            box-sizing: border-box;
            padding: 20px;
            border-radius: 10px;
            color: #e6653e;
            width: max-content;
        }

        .btnCoat:hover {
            background-color: #4a5869;
        }

        .products {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            margin: 36px 0px 0px;
        }

        .img {
            max-width: 200px;
            height: cover;
            margin: 0px 0px 34px;
        }

        .btn {
            display: none;
        }

        .product-item {
            box-shadow: 0px 0px 20px #c85634;
            box-sizing: border-box;
            padding: 30px 20px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: #ffff;
        }

        .prd-h3 {
            margin: 0px 0px 14px;
            color: #2c2c34;
        }

        .prd-price {
            margin: 0px 0px 44px;
            color: #3c4856;
        }

        .buy-btn {
            text-decoration: none;
            box-sizing: border-box;
            padding: 16px 32px;
            background-color: #4a5869;
            color: #ffff;
            border-radius: 10px;
            align-self: center;
        }

        .buy-btn:hover {
            box-shadow: 0px 0px 20px #c85634;
            color: #ff7146;
        }

        .delCart-btn {
            text-decoration: none;
            box-sizing: border-box;
            padding: 16px 32px;
            background-color: #4a5869;
            color: #ffff;
            border-radius: 10px;
            align-self: center;
        }

        .delCart-btn:hover {
            box-shadow: 0px 0px 20px #c85634;
            color: #ff7146;
        }

        .cartItem {
            position: absolute;
            top: 14px;
            right: 5px;
            background-color: #2c2c34;
            font-size: 10px;
            font-weight: bold;
            color: #ff7146;
            border-radius: 50px;
            box-sizing: border-box;
            padding: 3px;
            text-align: center;
            min-width: 20px;
            min-height: 20px;

        }

        .cartIncludes {
            box-sizing: border-box;
            padding: 20px 32px;
            display: none;
            flex-direction: column;
        }

        .cartImg {
            max-width: 240px;
            height: cover;
            margin: 0px 0px 34px;
            box-shadow: 0px 0px 20px #c85634;
            border-radius: 10px;
        }

        .cartText {
            font-size: 22px;
            font-weight: bold;
            color: #2c2c34;
            margin: 24px 0px 12px;
        }

        .cartBox {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: flex-start;
        }

        .btnCartBox {
            display: flex;
            gap: 24px;
        }

        .payWindow {
            display: none;
            position: absolute;
            top: 0px;
            left: 0px;
            z-index: 2;
            width: 100vw;
            height: 200vh;
            background: rgba(0, 0, 0, 0.589);
        }

        .payBox {
            position: sticky;
            z-index: 6;
            top: 140px;
            background-color: #ffff;
            background-image: url(https://terabyte-club.com/wp-content/uploads/2018/01/payment-1140x380.png);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: bottom;
            width: 400px;
            height: 400px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0px auto;
            box-sizing: border-box;
            padding: 32px 32px 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
        }

        .payText {
            color: #2c2c34;
            font-size: 20px;
            margin: 0px 0px 24px;
        }

        .payWait {
            max-width: 124px;
            height: auto;
        }

        .payServ {
            max-width: 124px;
            height: auto;
            display: none;
        }

        .textDI {
            margin: 64px auto;
            max-width: 640px;
            box-sizing: border-box;
            padding: 42px 64px;
            box-shadow: 0px 0px 20px #c85634;
            border-radius: 10px;
            color: #2c2c34;
            font-weight: bold;
            border: red;
        }

        .form {
            margin: 64px auto 0px;
            box-sizing: border-box;
            padding: 32px 0px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1280px;
        }

        .input {
            border: 1px solid #3c4856;
            box-sizing: border-box;
            font-size: 16px;
            padding: 10px 16px;
            max-width: 200px;
            background-color: #3c4856;
            color: #e6653e;
            border-radius: 10px;
        }

        .searchBox {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .searchImg {
            width: 40px;
            height: auto;
        }

        .textArea {
            max-width: 400px;
            box-sizing: border-box;
            font-size: 16px;
            padding: 10px 16px;
            background-color: #3c4856;
            border: 1px solid #3c4856;
            color: #e6653e;
            resize: none;
            border-radius: 10px;
        }

        .btnSendForm {
            box-sizing: border-box;
            padding: 20px;
            color: #e6653e;
            background-color: #3c4856;
            width: max-content;
            border-radius: 10px;
        }

        .btnSendForm:hover {
            background-color: #4a5869;
        }

        footer {
            background-color: #2c2c34;
        }

        .rights {
            align-self: center;
        }
    </style>
</head>

<body>
    <div id="payWindowId" class="payWindow"></div>
    <header>
        <div class="container">
            <div class="box-menu">
                <button id="btnMain" onclick="list.render(list.goods)" class="btn" type="button">Главная</button>
                <button id="btnCart" onclick="list.showCart()" class="btn" type="button">Корзина</button>
                <button id="btnCartClear" onclick="list.clear()" class="btn" type="button">Очистить</button>
                <button id="btnCartPay" onclick="list.pay()" class="btn" type="button">Оплатить</button>
                <label id="btnCoatMain1" for="btnMain" class="btnCoat">Главная</label>
                <div id="btnCoatMain2" onclick="list.clear()" class="btnCoat">Главная</div>
                <div class="searchBox" id="search">
                    <input class="input" v-model="searchLine" type="text">
                    <a href="#" onclick="searchGoods.showSearchResults(searchGoods.searchLine)"><img class="searchImg"
                            src="https://wmpics.pics/di-Q0JE.png" alt="search"></a>
                </div>
                <label for="btnCart" class="btnCoat">Корзина</label>
                <p v-if="isVisibleCart != 0" id="cartId" class="cartItem">{{ isVisibleCart }}</p>
            </div>
        </div>
    </header>
    <main>
        <div class="container">
            <div class="products">
                <div class="cartIncludes"></div>
            </div>
            <div id="textDialoge" class="textDI"></div>
        </div>
    </main>
    <footer>
        <form class="form" action="#">
            <input class="input" placeholder="Имя" id="inputName" required>
            <input class="input" placeholder="+7(000)000-0000" id="inputPhone" required>
            <input class="input" placeholder="email@gmail.com" id="inputEmail" required>
            <textarea class="textArea" cols="30" rows="10" placeholder="Ваш комментарий" id="inputText"></textarea>
            <a href="#" class="btnSendForm" type="submit" onClick="CheckData.readInt()">Отправить</a>
            <p class="rights">2021 &copy; Все права защищены</p>
        </form>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
    <script>
        'use strict'
        const API = 'https://raw.githubusercontent.com/GeekBrainsTutorial/online-store-api/master/responses';

        const searchGoods = new Vue({
            el: '#search',
            data: {
                searchLine: "",
                arrResults: [],
                showSearchResults(searchLine) {
                    if (searchLine != "") {
                        let regexp = new RegExp(searchLine, 'ig');
                        for (let value of list.goods) {
                            let result = regexp.test(value.title);
                            if (result) {
                                this.arrResults.push(value);
                            }
                        }

                        for (let value of this.arrResults) {
                            document.querySelector('.products').innerHTML =
                                `<div class="product-item">
                  <img class="img" src=${value.img}>
                  <h3 class="prd-h3">${value.title}</h3>
                  <p class="prd-price">Цена: ${value.price} руб.</p>
                  <a href="#" onClick="list.addToCart(${value.id - 1})" class="buy-btn">Купить</a>
               </div>`;
                        }

                    } else location.reload();
                }
            }
        });

        const CartGoods = new Vue({
            el: '#cartId',
            data: {
                name: 0,
                isVisibleCart: 0

            }
        });

        class ProductList {
            constructor(container = '.products') {
                this.container = container;
                this.sumProductResult = 0;
                this.cartQuantity = 0;
                this.cartFromJSON = [];
                this.goods = [];
                this.cart = [];
                this.fetchProducts();
                this.render(this.goods);
                //вывод товаров на страницу
                this._getProducts()
                    .then(data => { //data - объект js
                        this.cartFromJSON = [...data["contents"]];
                        console.log(this.cartFromJSON);
                    });
            }
            _getProducts() {
                return fetch(`${API}/getBasket.json`)
                    .then(result => result.json())
                    .catch(error => {
                        console.log(error);
                    })
            }

            fetchProducts() {
                this.goods = [
                    { id: 1, title: 'Notebook', quantity: 1, price: 120000, img: '"https://becompact.ru/upload/iblock/d0d/d0dc24a23943b06c975cec112bcb1926.jpg" alt="Notebook"' },
                    { id: 2, title: 'Mouse', quantity: 1, price: 8000, img: '"https://images.satom.ru/i3/firms/28/6028/6028200/pic_4c4383f3bf89b7e_1024x3000.jpg" alt="Mouse"' },
                    { id: 3, title: 'Keyboard', quantity: 1, price: 16000, img: '"https://im9.cz/sk/iR/importprodukt-orig/ab3/ab3c4df8cf901ba2a0a0f282e8a2c80b.jpg" alt="Keyboard"' },
                    { id: 4, title: 'Gamepad', quantity: 1, price: 50000, img: '"https://2emarket.ru/wa-data/public/shop/products/09/32/13209/images/14159/14159.970.jpg" alt="Gamepad"' },
                ];
            }

            render(arr) {
                const block = document.querySelector(this.container);
                for (let product of arr) {
                    const item = new ProductItem(product);
                    block.insertAdjacentHTML("beforeend", item.render());
                    //           block.innerHTML += item.render();
                }
                document.querySelector('.cartIncludes').style.display = "none";

                // document.querySelector('.cartItem').style.display = "none";
                document.getElementById("btnCoatMain1").style.display = "none";
                document.getElementById("btnCoatMain2").style.display = "inline-block";
                document.getElementById("textDialoge").style.display = "block";

            }
        }

        class ProductItem {
            constructor(product) {
                this.title = product.title;
                this.id = product.id;
                this.quantity = product.quantity;
                this.price = product.price;
                this.img = product.img;
            }
            render() {
                return `<div class="product-item">
                  <img class="img" src=${this.img}>
                  <h3 class="prd-h3">${this.title}</h3>
                  <p class="prd-price">Цена: ${this.price} руб.</p>
                  <a href="#" onClick="list.addToCart(${this.id - 1})" class="buy-btn">Купить</a>
               </div>`
            }
            renderCart(indexCart) {
                return `<div class="product-item">
                  <img class="img" src=${this.img}>
                  <h3 class="prd-h3">${this.title} (${this.quantity} шт.)</h3>
                  <p class="prd-price">Цена: ${this.price} руб.</p>
                  <a href="#" onClick="list.delFromCart(${indexCart})" class="delCart-btn">Удалить</a>
              </div>`
            }
        }
        class CartList extends ProductList {

            ready(a) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve(a);//после resolve всегда вызывается обработчик then
                    }, 5000);
                })
            }
            finish(a) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve(a);//после resolve всегда вызывается обработчик then
                    }, 8000);
                })
            }
            data(a) {
                document.getElementById("payWindowId").innerHTML =
                    `<div class= "payBox">
                        <p class= "payText">Операция выполнена успешно!</p>
                        <img class="payWait" src="https://talisman-khv.ru/uploads/s/m/0/l/m0lfqtjfolxp/img/full_tAP2TuGU.png" alt="redy">
                        </div>`;
            }
            pay() {
                if (this.cart.length !== 0) {
                    document.getElementById("payWindowId").style.display = "inline-block";
                    document.getElementById("payWindowId").innerHTML =
                        `<div class= "payBox">
                        <p class= "payText">Платеж обрабатывается...</p>
                        <img class="payWait" src="https://ds05.infourok.ru/uploads/ex/0bbc/00141c73-863691eb/hello_html_m73a3b47f.gif" alt="wait">
                        <img class="payServ" src="https://terabyte-club.com/wp-content/uploads/2018/01/payment-1140x380.png" alt="payServices">
                        </div>`;
                    this.ready(0)
                        .then(this.data);
                    this.finish(0)
                        .then(this.goStart);

                } else location.reload();
            }
            goStart(a) {
                location.reload();
            };
            clear() {
                location.reload();
            }
            cartSum() {
                this.cartQuantity = this.cart.reduce((sum, current) => sum + current.quantity, 0);
            }
            addToCart(n) {
                if (n >= 0) {
                    if (this.cart.length < 1) {
                        this.cart.push(this.goods[n]);
                    } else {
                        let checkM = true;
                        for (let value of this.cart) {
                            if (value.id == n + 1) {
                                value.quantity++;
                                checkM = false;
                            };
                        };
                        if (checkM) {
                            this.cart.push(this.goods[n]);
                        };
                    };
                    console.log(this.cart);
                    this.cartSum();
                    // document.querySelector('.cartItem').innerHTML = this.cartQuantity;
                    // document.querySelector('.cartItem').style.display = "inline-block";
                    CartGoods.isVisibleCart = this.cartQuantity;
                    const sumProductList = this.cart.map(item => item.price * item.quantity);
                    this.sumProductResult = sumProductList.reduce((sum, current) => sum + current, 0);
                    console.log(`Сумма всех товаров равна ${this.sumProductResult} рублей`);
                }
            }
            delFromCart(index) {
                if (this.cart[index].quantity <= 1) {
                    this.cart.splice(index, 1);
                } else {
                    this.cart[index].quantity--;
                };
                console.log(this.cart);
                this.cartSum();
                //document.querySelector('.cartItem').innerHTML = this.cartQuantity;
                CartGoods.isVisibleCart = this.cartQuantity;
                const sumProductList = this.cart.map(item => item.price * item.quantity);
                this.sumProductResult = sumProductList.reduce((sum, current) => sum + current, 0);
                console.log(`Сумма всех товаров равна ${this.sumProductResult} рублей`);
                this.showCart();
            }
            showCart() {
                document.querySelector('.products').innerHTML =
                    `<div class="cartIncludes">
                        <img class="cartImg" src="https://i2.imageban.ru/out/2020/07/12/67809400703089118e35d720cfef6836.jpg" alt="items">
                        <div class="cartBox"></div>
                <p class="cartText">Количество товаров в корзине: ${this.cartQuantity}</p>
                <p class="cartText">Сумма к оплате: ${this.sumProductResult} рублей</p>
                <div class="btnCartBox">
                <label for="btnCartClear" class="buy-btn">Очистить</label>
                <label for="btnCartPay" class="buy-btn">Оплатить</label>
                </div>
                </div>`;
                const cartBlock = document.querySelector('.cartBox');
                let indexArr = 0;
                for (let productCart of this.cart) {
                    const itemCart = new ProductItem(productCart);
                    cartBlock.insertAdjacentHTML("beforeend", itemCart.renderCart(indexArr));
                    indexArr++;
                }
                document.querySelector('.cartIncludes').style.display = "flex";
                document.getElementById("btnCoatMain2").style.display = "none";
                document.getElementById("btnCoatMain1").style.display = "inline-block";
                document.getElementById("textDialoge").style.display = "none";
            }
        }

        let list = new CartList();

        const textInfo = `<p>One: 'Hi Mary.' Two: 'Oh, hi.'</p>
 <p>One: 'How are you doing?'</p>
 <p>Two: 'I'm doing alright. How about you?'</p>
     <p>One: 'Not too bad. The weather is great isn't it?'</p>
     <p>Two: 'Yes. It's absolutely beautiful today.'</p>
 <p>One: 'I wish it was like this more frequently.'</p>
 <p>Two: 'Me too.'</p>
 <p>One: 'So where are you going now?'</p>
 <p>Two: 'I'm going to meet a friend of mine at the department store.'</p>
 <p>One: 'Going to do a little shopping?'</p>
 <p>Two: 'Yeah, I have to buy some presents for my parents.'</p>
 <p>One: 'What's the occasion?'</p>
     <p>Two: 'It's their anniversary.'</p>
 <p>One: 'That's great. Well, you better get going. You don't want to be late.'</p>
 <p>Two: 'I'll see you next time.'</p>
 <p>One: 'Sure. Bye.'</p>`
        let regexp = /'/g;
        let result = textInfo.replace(regexp, `"`);
        regexp = /\b"\b/g;
        result = result.replace(regexp, `'`);
        document.getElementById("textDialoge").innerHTML = result;

        class userDataMake {
            constructor() {
                this.userName = document.getElementById("inputName").value;
                this.userPhone = document.getElementById("inputPhone").value;
                this.userEmail = document.getElementById("inputEmail").value;
                this.userText = document.getElementById("inputText").value;
            }
        }
        class CheckUserData {
            readInt() {
                let newData = new userDataMake();
                let regExpName = /[a-zа-я]/gi;
                let resultName = this.checkReg(newData.userName, regExpName);
                this.getId("inputName", resultName)
                let regExpPhone = /\+[0-9]{1}\([0-9]{3}\)[0-9]{3}[-]{1}[0-9]{4}/dg;
                let resultPhone = this.checkReg(newData.userPhone, regExpPhone);
                this.getId("inputPhone", resultPhone)
                let regExpEmail = /[a-z0-9._-]+@[a-z0-9_-]+\.[a-z]{2,4}/gi;
                let resultEmail = this.checkReg(newData.userEmail, regExpEmail);
                this.getId("inputEmail", resultEmail)
                let regExpText = /[a-zа-я0-9]/gi;
                let resultText = this.checkReg(newData.userText, regExpText);
                this.getId("inputText", resultText)
                this.clearInput(resultName, resultPhone, resultEmail, resultText)

            }
            checkReg(str, regexp) {
                let result = regexp.test(str);
                return result;
            }
            getId(id, someResult) {
                if (!someResult) {
                    document.getElementById(id).style.borderColor = "red";
                    console.log(`Error ${id}`);
                } else {
                    document.getElementById(id).style.borderColor = "#2c2c34";
                    console.log(`Right ${id}`);
                }
            }
            clearInput(inp1, inp2, inp3, inp4) {
                if (inp1 && inp2 && inp3 && inp4) {
                    document.getElementById("inputName").value = "";
                    document.getElementById("inputPhone").value = "";
                    document.getElementById("inputEmail").value = "";
                    document.getElementById("inputText").value = "";
                }

            }
        }
        let CheckData = new CheckUserData();
    </script>
</body>

</html>